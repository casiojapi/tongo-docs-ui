<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Encryption System
  #

Tongo uses ElGamal encryption over elliptic curves to maintain confidential balances while enabling homomorphic operations on-chain.

  ElGamal Encryption
  #

Each user&rsquo;s balance is encrypted using a public key derived from their private key. The encryption function is defined as:
$$\begin{aligned}
\text{Enc}[y]: [0, b_{\max}) \times \mathbb{F}_p &\rightarrow G^2 \\
\text{Enc}[y](b,r) &= (L, R) = (g^b y^r, g^r)
\end{aligned}$$Where:

$y = g^x$ is the user&rsquo;s public key (derived from private key $x$)
$g$ is the generator of the Stark curve
$b$ is the balance amount in the range $[0, b_{\max})$
$r$ is a random blinding factor
$p$ is the curve order


  Additive Homomorphism
  #

The key property that makes Tongo efficient is additive homomorphism. Given two encryptions under the same public key, their product is a valid encryption of the sum:"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://casiojapi.github.io/tongo-docs-ui/docs/encryption/"><meta property="og:site_name" content="Tongo Protocol"><meta property="og:title" content="Encryption System"><meta property="og:description" content="Encryption System # Tongo uses ElGamal encryption over elliptic curves to maintain confidential balances while enabling homomorphic operations on-chain.
ElGamal Encryption # Each user’s balance is encrypted using a public key derived from their private key. The encryption function is defined as:
$$\begin{aligned} \text{Enc}[y]: [0, b_{\max}) \times \mathbb{F}_p &\rightarrow G^2 \\ \text{Enc}[y](b,r) &= (L, R) = (g^b y^r, g^r) \end{aligned}$$Where:
$y = g^x$ is the user’s public key (derived from private key $x$) $g$ is the generator of the Stark curve $b$ is the balance amount in the range $[0, b_{\max})$ $r$ is a random blinding factor $p$ is the curve order Additive Homomorphism # The key property that makes Tongo efficient is additive homomorphism. Given two encryptions under the same public key, their product is a valid encryption of the sum:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>Encryption System | Tongo Protocol</title><link rel=icon href=/tongo-docs-ui/favicon.png><link rel=manifest href=/tongo-docs-ui/manifest.json><link rel=canonical href=https://casiojapi.github.io/tongo-docs-ui/docs/encryption/><link rel=stylesheet href=/tongo-docs-ui/book.min.a3621cc5553a2d3e6c1eef6158eab15d0c78037147ea50c2b0cc1400e7b455c5.css integrity="sha256-o2IcxVU6LT5sHu9hWOqxXQx4A3FH6lDCsMwUAOe0VcU=" crossorigin=anonymous><script defer src=/tongo-docs-ui/fuse.min.js></script><script defer src=/tongo-docs-ui/en.search.min.6529a30bc1005f3aaf61226a5edadefecd354fb896a896fce7c5001e76d8d463.js integrity="sha256-ZSmjC8EAXzqvYSJqXtre/s01T7iWqJb858UAHnbY1GM=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\[",right:"\\]",display:!0},{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1})})</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/tongo-docs-ui/><span>Tongo Protocol</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/tongo-docs-ui/docs/intro-to-tongo/>Introduction</a></li><li><a href=/tongo-docs-ui/docs/encryption/ class=active>Encryption System</a></li><li><a href=/tongo-docs-ui/docs/transfer/>Transfer Protocol</a></li><li><a href=/tongo-docs-ui/docs/zk-proofs/>Zero-Knowledge Proof System</a></li><li><a href=/tongo-docs-ui/docs/auditor/>Auditing & Compliance</a></li><li><a href=/tongo-docs-ui/docs/sdk/>SDK Documentation</a></li><li><a href=/tongo-docs-ui/docs/contracts/>Cairo Contracts</a></li><li><a href=/tongo-docs-ui/docs/she/>SHE Library</a></li><li><a href=/tongo-docs-ui/docs/tongo-sdk/>TypeScript SDK</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/tongo-docs-ui/svg/menu.svg class=book-icon alt=Menu></label><h3>Encryption System</h3><label for=toc-control><img src=/tongo-docs-ui/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#elgamal-encryption>ElGamal Encryption</a></li><li><a href=#additive-homomorphism>Additive Homomorphism</a></li><li><a href=#balance-decryption>Balance Decryption</a></li><li><a href=#storage-architecture>Storage Architecture</a><ul><li><a href=#primary-balances>Primary Balances</a></li><li><a href=#recovery-balance>Recovery Balance</a></li></ul></li><li><a href=#security-properties>Security Properties</a><ul><li><a href=#computational-assumptions>Computational Assumptions</a></li><li><a href=#practical-security>Practical Security</a></li><li><a href=#privacy-guarantees>Privacy Guarantees</a></li></ul></li><li><a href=#example-fund-operation>Example: Fund Operation</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=encryption-system>Encryption System
<a class=anchor href=#encryption-system>#</a></h1><p>Tongo uses ElGamal encryption over elliptic curves to maintain confidential balances while enabling homomorphic operations on-chain.</p><h2 id=elgamal-encryption>ElGamal Encryption
<a class=anchor href=#elgamal-encryption>#</a></h2><p>Each user&rsquo;s balance is encrypted using a public key derived from their private key. The encryption function is defined as:</p>$$\begin{aligned}
\text{Enc}[y]: [0, b_{\max}) \times \mathbb{F}_p &\rightarrow G^2 \\
\text{Enc}[y](b,r) &= (L, R) = (g^b y^r, g^r)
\end{aligned}$$<p>Where:</p><ul><li>$y = g^x$ is the user&rsquo;s public key (derived from private key $x$)</li><li>$g$ is the generator of the Stark curve</li><li>$b$ is the balance amount in the range $[0, b_{\max})$</li><li>$r$ is a random blinding factor</li><li>$p$ is the curve order</li></ul><h2 id=additive-homomorphism>Additive Homomorphism
<a class=anchor href=#additive-homomorphism>#</a></h2><p>The key property that makes Tongo efficient is <strong>additive homomorphism</strong>. Given two encryptions under the same public key, their product is a valid encryption of the sum:</p>$$\text{Enc}[y](b,r) \cdot \text{Enc}[y](b',r') = (g^{b+b'} y^{r+r'}, g^{r+r'}) = \text{Enc}[y](b+b', r+r')$$<p>This allows the contract to:</p><ul><li>Add encrypted amounts without decryption</li><li>Subtract encrypted amounts homomorphically</li><li>Update balances while maintaining privacy</li></ul><h2 id=balance-decryption>Balance Decryption
<a class=anchor href=#balance-decryption>#</a></h2><p>To read their balance, a user recovers $g^b$ using their private key $x$:</p>$$g^b = \frac{L}{R^x} = \frac{g^b y^r}{(g^r)^x} = \frac{g^b (g^x)^r}{g^{rx}} = g^b$$<p>Since $b$ is bounded by $[0, 2^{32})$, the discrete logarithm $b$ can be computed efficiently through:</p><ol><li><strong>Brute force</strong>: Iterate $g^i$ for $i = 0, 1, 2, &mldr;$ until matching $g^b$</li><li><strong>Baby-step Giant-step</strong>: More efficient $O(\sqrt{n})$ algorithm</li><li><strong>Pollard&rsquo;s rho</strong>: Probabilistic algorithm with similar complexity</li></ol><p>A naïve JavaScript implementation can decrypt ~100k units per second, while optimized algorithms handle the full 32-bit range much faster.</p><h2 id=storage-architecture>Storage Architecture
<a class=anchor href=#storage-architecture>#</a></h2><p>The Tongo contract maintains multiple encrypted representations of each balance:</p><h3 id=primary-balances>Primary Balances
<a class=anchor href=#primary-balances>#</a></h3><ul><li><strong><code>balance</code></strong>: Current encrypted balance using user&rsquo;s public key</li><li><strong><code>audit_balance</code></strong>: Same balance encrypted for global auditor&rsquo;s key</li><li><strong><code>pending</code></strong>: Buffer for incoming transfers (anti-spam protection)</li></ul><h3 id=recovery-balance>Recovery Balance
<a class=anchor href=#recovery-balance>#</a></h3><ul><li><strong><code>sym_balance</code></strong>: Symmetrically encrypted balance for fast recovery</li></ul><p>The symmetric encryption uses a key derived from the user&rsquo;s private key, allowing instant balance recovery without discrete log computation. This is particularly useful for mobile wallets and cross-device synchronization.</p><blockquote class="book-hint info">**Implementation Note**: The `sym_balance` is not cryptographically enforced by the protocol since there's no way to prove the user provided the correct symmetric ciphertext. It's purely a convenience feature.</blockquote><h2 id=security-properties>Security Properties
<a class=anchor href=#security-properties>#</a></h2><h3 id=computational-assumptions>Computational Assumptions
<a class=anchor href=#computational-assumptions>#</a></h3><ul><li><strong>Discrete Log Problem</strong>: Hard to find $x$ given $g^x$</li><li><strong>Decisional Diffie-Hellman</strong>: Hard to distinguish random group elements from valid encryptions</li></ul><h3 id=practical-security>Practical Security
<a class=anchor href=#practical-security>#</a></h3><ul><li><strong>32-bit range</strong>: Balances limited to $[0, 2^{32})$ for efficient decryption</li><li><strong>Random blinding</strong>: Each encryption uses fresh randomness</li><li><strong>Curve security</strong>: Relies on Stark curve (ECDSA-256 security level)</li></ul><h3 id=privacy-guarantees>Privacy Guarantees
<a class=anchor href=#privacy-guarantees>#</a></h3><ul><li><strong>Balance confidentiality</strong>: Only the key holder can decrypt</li><li><strong>Transaction privacy</strong>: Transfer amounts remain hidden</li><li><strong>Unlinkability</strong>: Encrypted balances don&rsquo;t reveal relationships</li></ul><h2 id=example-fund-operation>Example: Fund Operation
<a class=anchor href=#example-fund-operation>#</a></h2><p>When a user funds their account with amount $b$:</p><ol><li><strong>Public inputs</strong>: $b$ (revealed in ERC20 transfer), $y$ (user&rsquo;s public key)</li><li><strong>Encryption</strong>: $\text{Enc}[y](b, 1) = (g^b y, g)$</li><li><strong>Storage</strong>: Add to user&rsquo;s encrypted balance homomorphically</li></ol><p>Note that $r = 1$ is used for funding since the amount $b$ is already public in the ERC20 transaction.</p><pre tabindex=0><code class=language-cairo data-lang=cairo>// Cairo implementation (simplified)
let funded_cipher = CipherBalance {
    CL: (curve_ops::multiply(G, b) + curve_ops::multiply(y, 1)),
    CR: curve_ops::multiply(G, 1)
};

// Add to existing balance homomorphically
balance = cipher_add(balance, funded_cipher);
</code></pre><p>The homomorphic addition is performed point-wise:</p><ul><li>$L_{\text{new}} = L_{\text{old}} \cdot L_{\text{fund}}$</li><li>$R_{\text{new}} = R_{\text{old}} \cdot R_{\text{fund}}$</li></ul><p>This mathematical elegance allows Tongo to update balances without ever revealing the underlying amounts, forming the foundation for all confidential operations in the protocol.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/fatlabsxyz/tongo-docs/edit/master/packages/tongo-docs/content/docs/encryption.md target=_blank rel=noopener><img src=/tongo-docs-ui/svg/edit.svg class=book-icon alt>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#elgamal-encryption>ElGamal Encryption</a></li><li><a href=#additive-homomorphism>Additive Homomorphism</a></li><li><a href=#balance-decryption>Balance Decryption</a></li><li><a href=#storage-architecture>Storage Architecture</a><ul><li><a href=#primary-balances>Primary Balances</a></li><li><a href=#recovery-balance>Recovery Balance</a></li></ul></li><li><a href=#security-properties>Security Properties</a><ul><li><a href=#computational-assumptions>Computational Assumptions</a></li><li><a href=#practical-security>Practical Security</a></li><li><a href=#privacy-guarantees>Privacy Guarantees</a></li></ul></li><li><a href=#example-fund-operation>Example: Fund Operation</a></li></ul></nav></div></aside></main></body></html>