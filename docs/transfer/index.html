<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Transfer Protocol
  #

The transfer operation is the core of Tongo&rsquo;s confidential payment system, allowing users to send encrypted amounts while proving transaction validity through zero-knowledge proofs.

  Transfer Overview
  #

When a user (sender) with public key $y_s$ and balance $b_0$ wants to transfer amount $b < b_0$ to a receiver with public key $y_r$, they must:

Create encryptions for sender, receiver, and auditor
Generate ZK proofs to validate the transaction
Submit transaction with ciphertexts and proofs

The key insight is that balances are updated homomorphically without revealing the transfer amount."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://docs.tongo.cash/docs/transfer/"><meta property="og:site_name" content="Tongo Protocol"><meta property="og:title" content="Transfer Protocol"><meta property="og:description" content="Transfer Protocol # The transfer operation is the core of Tongoâ€™s confidential payment system, allowing users to send encrypted amounts while proving transaction validity through zero-knowledge proofs.
Transfer Overview # When a user (sender) with public key $y_s$ and balance $b_0$ wants to transfer amount $b < b_0$ to a receiver with public key $y_r$, they must:
Create encryptions for sender, receiver, and auditor Generate ZK proofs to validate the transaction Submit transaction with ciphertexts and proofs The key insight is that balances are updated homomorphically without revealing the transfer amount."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>Transfer Protocol | Tongo Protocol</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://docs.tongo.cash/docs/transfer/><link rel=stylesheet href=/book.min.a3621cc5553a2d3e6c1eef6158eab15d0c78037147ea50c2b0cc1400e7b455c5.css integrity="sha256-o2IcxVU6LT5sHu9hWOqxXQx4A3FH6lDCsMwUAOe0VcU=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.f638ad1f04431c5b01b2701c0a28e77eeebeee90e0dd56137e0021af744964d2.js integrity="sha256-9jitHwRDHFsBsnAcCijnfu6+7pDg3VYTfgAhr3RJZNI=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\[",right:"\\]",display:!0},{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1})})</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Tongo Protocol</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/intro-to-tongo/>Introduction</a></li><li><a href=/docs/encryption/>Encryption System</a></li><li><a href=/docs/transfer/ class=active>Transfer Protocol</a></li><li><a href=/docs/zk-proofs/>Zero-Knowledge Proof System</a></li><li><a href=/docs/auditor/>Auditing & Compliance</a></li><li><a href=/docs/sdk/>SDK Documentation</a></li><li><a href=/docs/contracts/>Cairo Contracts</a></li><li><a href=/docs/she/>SHE Library</a></li><li><a href=/docs/tongo-sdk/>TypeScript SDK</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Transfer Protocol</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#transfer-overview>Transfer Overview</a></li><li><a href=#multi-party-encryption>Multi-Party Encryption</a><ul><li><a href=#sender-encryption>Sender Encryption</a></li><li><a href=#receiver-encryption>Receiver Encryption</a></li><li><a href=#auditor-encryption>Auditor Encryption</a></li></ul></li><li><a href=#transaction-structure>Transaction Structure</a></li><li><a href=#required-zero-knowledge-proofs>Required Zero-Knowledge Proofs</a><ul><li><a href=#1-ownership-proof-poe>1. Ownership Proof (POE)</a></li><li><a href=#2-blinding-factor-proof-poe>2. Blinding Factor Proof (POE)</a></li><li><a href=#3-encryption-validity-ped>3. Encryption Validity (PED)</a></li><li><a href=#4-range-proofs-ran>4. Range Proofs (RAN)</a></li></ul></li><li><a href=#complete-transfer-proof>Complete Transfer Proof</a></li><li><a href=#balance-updates>Balance Updates</a><ul><li><a href=#sender-balance-update>Sender Balance Update</a></li><li><a href=#receiver-pending-update>Receiver Pending Update</a></li></ul></li><li><a href=#anti-spam-protection>Anti-Spam Protection</a></li><li><a href=#example-flow>Example Flow</a></li><li><a href=#security-considerations>Security Considerations</a><ul><li><a href=#replay-protection>Replay Protection</a></li><li><a href=#range-proof-security>Range Proof Security</a></li><li><a href=#homomorphic-security>Homomorphic Security</a></li></ul></li><li><a href=#gas-optimization>Gas Optimization</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=transfer-protocol>Transfer Protocol
<a class=anchor href=#transfer-protocol>#</a></h1><p>The transfer operation is the core of Tongo&rsquo;s confidential payment system, allowing users to send encrypted amounts while proving transaction validity through zero-knowledge proofs.</p><h2 id=transfer-overview>Transfer Overview
<a class=anchor href=#transfer-overview>#</a></h2><p>When a user (sender) with public key $y_s$ and balance $b_0$ wants to transfer amount $b &lt; b_0$ to a receiver with public key $y_r$, they must:</p><ol><li><strong>Create encryptions</strong> for sender, receiver, and auditor</li><li><strong>Generate ZK proofs</strong> to validate the transaction</li><li><strong>Submit transaction</strong> with ciphertexts and proofs</li></ol><p>The key insight is that balances are updated <strong>homomorphically</strong> without revealing the transfer amount.</p><h2 id=multi-party-encryption>Multi-Party Encryption
<a class=anchor href=#multi-party-encryption>#</a></h2><p>The sender creates (at least) three encryptions of the same amount $b$ using the same blinding factor $r$:</p><h3 id=sender-encryption>Sender Encryption
<a class=anchor href=#sender-encryption>#</a></h3>$$(\mathit{L_s}, \mathit{R_s}) = \text{Enc}[y_s](b, r) = (g^b y_s^r, g^r)$$<p>This will be <strong>subtracted</strong> from the sender&rsquo;s balance.</p><h3 id=receiver-encryption>Receiver Encryption
<a class=anchor href=#receiver-encryption>#</a></h3>$$(\mathit{L_r}, \mathit{R_r}) = \text{Enc}[y_r](b, r) = (g^b y_r^r, g^r)$$<p>This will be <strong>added</strong> to the receiver&rsquo;s pending balance.</p><h3 id=auditor-encryption>Auditor Encryption
<a class=anchor href=#auditor-encryption>#</a></h3>$$(\mathit{L_a}, \mathit{R_a}) = \text{Enc}[y_a](b, r) = (g^b y_a^r, g^r)$$<p>This provides an audit trail for compliance without revealing amounts.</p><blockquote class="book-hint warning">**Security Note**: Using the same blinding factor $r$ across all encryptions is safe for single-recipient transfers but could enable insider attacks in multi-recipient schemes. Tongo mitigates this by design.</blockquote><h2 id=transaction-structure>Transaction Structure
<a class=anchor href=#transaction-structure>#</a></h2><pre tabindex=0><code class=language-cairo data-lang=cairo>struct Transfer {
    from: PubKey,           // Sender&#39;s public key
    to: PubKey,             // Receiver&#39;s public key  
    L: StarkPoint,          // L_s (sender encryption left)
    L_rec: StarkPoint,      // L_r (receiver encryption left)
    L_audit: StarkPoint,    // L_a (auditor encryption left)
    L_opt: Option&lt;Array&lt;(PubKey, StarkPoint)&gt;&gt;, // Additional viewing keys
    R: StarkPoint,          // Shared R component
    proof: ProofOfTransfer, // ZK proof bundle
}
</code></pre><h2 id=required-zero-knowledge-proofs>Required Zero-Knowledge Proofs
<a class=anchor href=#required-zero-knowledge-proofs>#</a></h2><p>The sender must provide a comprehensive proof $\pi_{\text{transfer}}$ demonstrating:</p><h3 id=1-ownership-proof-poe>1. Ownership Proof (POE)
<a class=anchor href=#1-ownership-proof-poe>#</a></h3><p>Prove knowledge of private key $x$ such that $y_s = g^x$:</p>$$\pi_{\text{ownership}}: \{(g, y_s; x) : y_s = g^x\}$$<h3 id=2-blinding-factor-proof-poe>2. Blinding Factor Proof (POE)
<a class=anchor href=#2-blinding-factor-proof-poe>#</a></h3><p>Prove knowledge of $r$ such that $R = g^r$:</p>$$\pi_{\text{blinding}}: \{(g, R; r) : R = g^r\}$$<h3 id=3-encryption-validity-ped>3. Encryption Validity (PED)
<a class=anchor href=#3-encryption-validity-ped>#</a></h3><p>Prove that $L_s$ is correctly formed:</p>$$\pi_{\text{sender}}: \{(g, y_s, L_s; b, r) : L_s = g^b y_s^r\}$$<p>Prove that $L_r$ uses the same $b$ and $r$:</p>$$\pi_{\text{receiver}}: \{(g, y_r, L_r; b, r) : L_r = g^b y_r^r\}$$<p>Prove that $L_a$ uses the same $b$ and $r$:</p>$$\pi_{\text{auditor}}: \{(g, y_a, L_a; b, r) : L_a = g^b y_a^r\}$$<h3 id=4-range-proofs-ran>4. Range Proofs (RAN)
<a class=anchor href=#4-range-proofs-ran>#</a></h3><p>Prove the transfer amount is positive:</p>$$\pi_{\text{amount}}: \{(g, h, V_b; b, r_b) : V_b = g^b h^{r_b} \land b \in [0, b_{\max})\}$$<p>Prove the remaining balance is non-negative:</p>$$\pi_{\text{remaining}}: \{(g, h, V_{b'}; b', r_{b'}) : V_{b'} = g^{b'} h^{r_{b'}} \land b' \in [0, b_{\max})\}$$<p>Where $b&rsquo; = b_0 - b$ is the sender&rsquo;s balance after the transfer.</p><h2 id=complete-transfer-proof>Complete Transfer Proof
<a class=anchor href=#complete-transfer-proof>#</a></h2><p>The full proof statement combines all requirements:</p>$$\begin{aligned}
\pi_{\text{transfer}}: \{&(g, y_s, y_r, L_0, R_0, L_s, L_r, R; x, b, b', r) : \\
&y_s = g^x \\
&\land R = g^r \\
&\land L_s = g^b y_s^r \\
&\land L_r = g^b y_r^r \\
&\land b \in [0, b_{\max}) \\
&\land L_0/L_s = g^{b'}(R_0/R)^x \\
&\land b' \in [0, b_{\max})\}
\end{aligned}$$<p>Where $(L_0, R_0)$ represents the sender&rsquo;s current encrypted balance.</p><h2 id=balance-updates>Balance Updates
<a class=anchor href=#balance-updates>#</a></h2><p>Upon successful proof verification, the contract performs homomorphic updates:</p><h3 id=sender-balance-update>Sender Balance Update
<a class=anchor href=#sender-balance-update>#</a></h3><pre tabindex=0><code class=language-cairo data-lang=cairo>// Subtract transfer amount from sender
new_sender_balance = cipher_subtract(old_sender_balance, sender_cipher);
</code></pre><p>Mathematically: $(L_0, R_0) \div (L_s, R_s) = (L_0/L_s, R_0/R_s)$</p><h3 id=receiver-pending-update>Receiver Pending Update
<a class=anchor href=#receiver-pending-update>#</a></h3><pre tabindex=0><code class=language-cairo data-lang=cairo>// Add transfer amount to receiver&#39;s pending balance
new_pending_balance = cipher_add(old_pending_balance, receiver_cipher);
</code></pre><p>Mathematically: $(L_p, R_p) \cdot (L_r, R_r) = (L_p \cdot L_r, R_p \cdot R_r)$</p><h2 id=anti-spam-protection>Anti-Spam Protection
<a class=anchor href=#anti-spam-protection>#</a></h2><p>Transfers are added to the receiver&rsquo;s <code>pending</code> balance rather than their main balance to prevent spam attacks. This design:</p><ol><li><strong>Prevents balance corruption</strong>: Malicious actors can&rsquo;t modify someone&rsquo;s main balance</li><li><strong>Enables atomic proofs</strong>: Senders prove against a known balance state</li><li><strong>Requires explicit rollover</strong>: Receivers must claim pending transfers</li></ol><p>The receiver later calls <code>rollover()</code> to merge pending transfers into their main balance.</p><h2 id=example-flow>Example Flow
<a class=anchor href=#example-flow>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// 1. Sender creates transfer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>transfer</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>sender</span>.<span style=color:#a6e22e>transfer</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to</span>: <span style=color:#66d9ef>receiverPubKey</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>amount</span>: <span style=color:#66d9ef>100n</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>viewKeys</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>auditorPubKey</span>] <span style=color:#75715e>// Optional additional viewers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 2. Submit to contract
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>signer</span>.<span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>transfer</span>.<span style=color:#a6e22e>toCallData</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 3. Receiver claims pending balance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>rollover</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>receiver</span>.<span style=color:#a6e22e>rollover</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>signer</span>.<span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>rollover</span>.<span style=color:#a6e22e>toCallData</span>());
</span></span></code></pre></div><h2 id=security-considerations>Security Considerations
<a class=anchor href=#security-considerations>#</a></h2><h3 id=replay-protection>Replay Protection
<a class=anchor href=#replay-protection>#</a></h3><p>Each proof includes the sender&rsquo;s nonce and contract address in the Fiat-Shamir challenge computation, preventing proof reuse.</p><h3 id=range-proof-security>Range Proof Security
<a class=anchor href=#range-proof-security>#</a></h3><p>The 32-bit range proofs ensure:</p><ul><li>Transfer amounts are non-negative</li><li>Remaining balances don&rsquo;t underflow</li><li>No &ldquo;money creation&rdquo; attacks</li></ul><h3 id=homomorphic-security>Homomorphic Security
<a class=anchor href=#homomorphic-security>#</a></h3><p>The ElGamal encryption scheme maintains semantic security even under homomorphic operations, ensuring transferred amounts remain confidential.</p><h2 id=gas-optimization>Gas Optimization
<a class=anchor href=#gas-optimization>#</a></h2><p>Transfer verification costs approximately <strong>120K Cairo steps</strong>, making it efficient compared to other ZK verification schemes:</p><table><thead><tr><th>Component</th><th>Cairo Steps</th><th>Percentage</th></tr></thead><tbody><tr><td>POE proofs</td><td>~30K</td><td>25%</td></tr><tr><td>PED proofs</td><td>~40K</td><td>33%</td></tr><tr><td>Range proofs</td><td>~45K</td><td>38%</td></tr><tr><td>Contract logic</td><td>~5K</td><td>4%</td></tr></tbody></table><p>Future optimizations target reducing range proof costs through Bulletproof integration and more efficient bit decomposition techniques.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/fatlabsxyz/tongo-docs/edit/master/packages/tongo-docs/content/docs/transfer.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#transfer-overview>Transfer Overview</a></li><li><a href=#multi-party-encryption>Multi-Party Encryption</a><ul><li><a href=#sender-encryption>Sender Encryption</a></li><li><a href=#receiver-encryption>Receiver Encryption</a></li><li><a href=#auditor-encryption>Auditor Encryption</a></li></ul></li><li><a href=#transaction-structure>Transaction Structure</a></li><li><a href=#required-zero-knowledge-proofs>Required Zero-Knowledge Proofs</a><ul><li><a href=#1-ownership-proof-poe>1. Ownership Proof (POE)</a></li><li><a href=#2-blinding-factor-proof-poe>2. Blinding Factor Proof (POE)</a></li><li><a href=#3-encryption-validity-ped>3. Encryption Validity (PED)</a></li><li><a href=#4-range-proofs-ran>4. Range Proofs (RAN)</a></li></ul></li><li><a href=#complete-transfer-proof>Complete Transfer Proof</a></li><li><a href=#balance-updates>Balance Updates</a><ul><li><a href=#sender-balance-update>Sender Balance Update</a></li><li><a href=#receiver-pending-update>Receiver Pending Update</a></li></ul></li><li><a href=#anti-spam-protection>Anti-Spam Protection</a></li><li><a href=#example-flow>Example Flow</a></li><li><a href=#security-considerations>Security Considerations</a><ul><li><a href=#replay-protection>Replay Protection</a></li><li><a href=#range-proof-security>Range Proof Security</a></li><li><a href=#homomorphic-security>Homomorphic Security</a></li></ul></li><li><a href=#gas-optimization>Gas Optimization</a></li></ul></nav></div></aside></main></body></html>