<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Starknet Homomorphic Encryption (SHE)
  #

The SHE library (she-js) provides low-level cryptographic primitives for ElGamal encryption and zero-knowledge proof generation over the Stark elliptic curve. It serves as the foundation for all cryptographic operations in Tongo.

  Installation
  #

npm install she-js

  Core Concepts
  #


  Elliptic Curve Setup
  #

SHE operates over the Stark curve with carefully chosen generators:
import { g, h, view, auditor_key } from 'she-js';

// Primary generator (standard Stark curve generator)
const g: ProjectivePoint;

// Secondary generator (derived from π digits - nothing up my sleeve)
const h: ProjectivePoint;

// Global auditor public key
const view: ProjectivePoint;

// Global auditor secret key (for testing)
const auditor_key: bigint;


  ElGamal Encryption
  #


  Basic Encryption
  #

import { cipher_balance, decipher_balance } from 'she-js';

// Encrypt a balance amount
function cipher_balance(
  amount: bigint,           // Amount to encrypt
  publicKey: ProjectivePoint, // Recipient's public key
  randomness?: bigint       // Optional blinding factor
): CipherBalance;

// Example
const pubkey = g.multiply(secretKey);
const encrypted = cipher_balance(1000n, pubkey);
console.log(encrypted); // { L: Point, R: Point }

  Decryption
  #

// Decrypt a ciphertext (requires brute force for amount)
function decipher_balance(
  cipher: CipherBalance,
  secretKey: bigint,
  maxAmount: bigint = 1000000n
): bigint;

// Example
const amount = decipher_balance(encrypted, secretKey, 1000000n);
console.log(amount); // 1000n

  Homomorphic Operations
  #

// Add two encrypted balances
function cipher_add(
  cipher1: CipherBalance,
  cipher2: CipherBalance
): CipherBalance;

// Subtract encrypted balances  
function cipher_subtract(
  cipher1: CipherBalance,
  cipher2: CipherBalance
): CipherBalance;

// Example: encrypted arithmetic
const encrypted1 = cipher_balance(100n, pubkey);
const encrypted2 = cipher_balance(50n, pubkey);
const sum = cipher_add(encrypted1, encrypted2);
const result = decipher_balance(sum, secretKey); // 150n


  Zero-Knowledge Proofs
  #


  Proof of Exponent (POE)
  #

Proves knowledge of discrete logarithm \\(x\\) such that \\(y = g^x\\):"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://docs.tongo.cash/docs/she/"><meta property="og:site_name" content="Tongo Protocol"><meta property="og:title" content="SHE Library"><meta property="og:description" content="Starknet Homomorphic Encryption (SHE) # The SHE library (she-js) provides low-level cryptographic primitives for ElGamal encryption and zero-knowledge proof generation over the Stark elliptic curve. It serves as the foundation for all cryptographic operations in Tongo.
Installation # npm install she-js Core Concepts # Elliptic Curve Setup # SHE operates over the Stark curve with carefully chosen generators:
import { g, h, view, auditor_key } from 'she-js'; // Primary generator (standard Stark curve generator) const g: ProjectivePoint; // Secondary generator (derived from π digits - nothing up my sleeve) const h: ProjectivePoint; // Global auditor public key const view: ProjectivePoint; // Global auditor secret key (for testing) const auditor_key: bigint; ElGamal Encryption # Basic Encryption # import { cipher_balance, decipher_balance } from 'she-js'; // Encrypt a balance amount function cipher_balance( amount: bigint, // Amount to encrypt publicKey: ProjectivePoint, // Recipient's public key randomness?: bigint // Optional blinding factor ): CipherBalance; // Example const pubkey = g.multiply(secretKey); const encrypted = cipher_balance(1000n, pubkey); console.log(encrypted); // { L: Point, R: Point } Decryption # // Decrypt a ciphertext (requires brute force for amount) function decipher_balance( cipher: CipherBalance, secretKey: bigint, maxAmount: bigint = 1000000n ): bigint; // Example const amount = decipher_balance(encrypted, secretKey, 1000000n); console.log(amount); // 1000n Homomorphic Operations # // Add two encrypted balances function cipher_add( cipher1: CipherBalance, cipher2: CipherBalance ): CipherBalance; // Subtract encrypted balances function cipher_subtract( cipher1: CipherBalance, cipher2: CipherBalance ): CipherBalance; // Example: encrypted arithmetic const encrypted1 = cipher_balance(100n, pubkey); const encrypted2 = cipher_balance(50n, pubkey); const sum = cipher_add(encrypted1, encrypted2); const result = decipher_balance(sum, secretKey); // 150n Zero-Knowledge Proofs # Proof of Exponent (POE) # Proves knowledge of discrete logarithm \\(x\\) such that \\(y = g^x\\):"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>SHE Library | Tongo Protocol</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://docs.tongo.cash/docs/she/><link rel=stylesheet href=/book.min.a3621cc5553a2d3e6c1eef6158eab15d0c78037147ea50c2b0cc1400e7b455c5.css integrity="sha256-o2IcxVU6LT5sHu9hWOqxXQx4A3FH6lDCsMwUAOe0VcU=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.08e619da744a3a9339f34fb422eb78fd98793d12f9217328a022d56b5f38d299.js integrity="sha256-COYZ2nRKOpM580+0Iut4/Zh5PRL5IXMooCLVa1840pk=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\[",right:"\\]",display:!0},{left:"$$",right:"$$",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Tongo Protocol</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/docs/intro-to-tongo/>Introduction</a></li><li><a href=/docs/encryption/>Encryption System</a></li><li><a href=/docs/transfer/>Transfer Protocol</a></li><li><a href=/docs/auditor/>Auditing & Compliance</a></li><li><a href=/docs/sdk/>SDK Documentation</a></li><li><a href=/docs/contracts/>Cairo Contracts</a></li><li><a href=/docs/she/ class=active>SHE Library</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>SHE Library</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#installation>Installation</a></li><li><a href=#core-concepts>Core Concepts</a><ul><li><a href=#elliptic-curve-setup>Elliptic Curve Setup</a></li></ul></li><li><a href=#elgamal-encryption>ElGamal Encryption</a><ul><li><a href=#basic-encryption>Basic Encryption</a></li><li><a href=#decryption>Decryption</a></li><li><a href=#homomorphic-operations>Homomorphic Operations</a></li></ul></li><li><a href=#zero-knowledge-proofs>Zero-Knowledge Proofs</a><ul><li><a href=#proof-of-exponent-poe>Proof of Exponent (POE)</a></li><li><a href=#transfer-proofs>Transfer Proofs</a></li><li><a href=#range-proofs>Range Proofs</a></li><li><a href=#withdrawal-proofs>Withdrawal Proofs</a></li></ul></li><li><a href=#audit-system>Audit System</a><ul><li><a href=#ex-post-proofs>Ex-Post Proofs</a></li></ul></li><li><a href=#utility-functions>Utility Functions</a><ul><li><a href=#key-management>Key Management</a></li><li><a href=#hash-functions>Hash Functions</a></li></ul></li><li><a href=#advanced-features>Advanced Features</a><ul><li><a href=#batch-operations>Batch Operations</a></li><li><a href=#custom-generators>Custom Generators</a></li></ul></li><li><a href=#performance-considerations>Performance Considerations</a><ul><li><a href=#optimization-tips>Optimization Tips</a></li><li><a href=#memory-management>Memory Management</a></li></ul></li><li><a href=#error-handling>Error Handling</a></li><li><a href=#type-definitions>Type Definitions</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=starknet-homomorphic-encryption-she>Starknet Homomorphic Encryption (SHE)
<a class=anchor href=#starknet-homomorphic-encryption-she>#</a></h1><p>The SHE library (<code>she-js</code>) provides low-level cryptographic primitives for ElGamal encryption and zero-knowledge proof generation over the Stark elliptic curve. It serves as the foundation for all cryptographic operations in Tongo.</p><h2 id=installation>Installation
<a class=anchor href=#installation>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install she-js
</span></span></code></pre></div><h2 id=core-concepts>Core Concepts
<a class=anchor href=#core-concepts>#</a></h2><h3 id=elliptic-curve-setup>Elliptic Curve Setup
<a class=anchor href=#elliptic-curve-setup>#</a></h3><p>SHE operates over the Stark curve with carefully chosen generators:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>g</span>, <span style=color:#a6e22e>h</span>, <span style=color:#a6e22e>view</span>, <span style=color:#a6e22e>auditor_key</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Primary generator (standard Stark curve generator)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>g</span>: <span style=color:#66d9ef>ProjectivePoint</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Secondary generator (derived from π digits - nothing up my sleeve)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>h</span>: <span style=color:#66d9ef>ProjectivePoint</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Global auditor public key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>view</span>: <span style=color:#66d9ef>ProjectivePoint</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Global auditor secret key (for testing)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>auditor_key</span>: <span style=color:#66d9ef>bigint</span>;
</span></span></code></pre></div><hr><h2 id=elgamal-encryption>ElGamal Encryption
<a class=anchor href=#elgamal-encryption>#</a></h2><h3 id=basic-encryption>Basic Encryption
<a class=anchor href=#basic-encryption>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>cipher_balance</span>, <span style=color:#a6e22e>decipher_balance</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Encrypt a balance amount
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>cipher_balance</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>amount</span>: <span style=color:#66d9ef>bigint</span>,           <span style=color:#75715e>// Amount to encrypt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>publicKey</span>: <span style=color:#66d9ef>ProjectivePoint</span>, <span style=color:#75715e>// Recipient&#39;s public key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>randomness?</span>: <span style=color:#66d9ef>bigint</span>       <span style=color:#75715e>// Optional blinding factor
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>CipherBalance</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Example
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pubkey</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>multiply</span>(<span style=color:#a6e22e>secretKey</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>encrypted</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cipher_balance</span>(<span style=color:#ae81ff>1000</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>pubkey</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>encrypted</span>); <span style=color:#75715e>// { L: Point, R: Point }
</span></span></span></code></pre></div><h3 id=decryption>Decryption
<a class=anchor href=#decryption>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Decrypt a ciphertext (requires brute force for amount)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>decipher_balance</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cipher</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>secretKey</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>maxAmount</span>: <span style=color:#66d9ef>bigint</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000000</span><span style=color:#a6e22e>n</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>bigint</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Example
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>amount</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>decipher_balance</span>(<span style=color:#a6e22e>encrypted</span>, <span style=color:#a6e22e>secretKey</span>, <span style=color:#ae81ff>1000000</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>amount</span>); <span style=color:#75715e>// 1000n
</span></span></span></code></pre></div><h3 id=homomorphic-operations>Homomorphic Operations
<a class=anchor href=#homomorphic-operations>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Add two encrypted balances
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>cipher_add</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cipher1</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cipher2</span>: <span style=color:#66d9ef>CipherBalance</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>CipherBalance</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Subtract encrypted balances  
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>cipher_subtract</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cipher1</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cipher2</span>: <span style=color:#66d9ef>CipherBalance</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>CipherBalance</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Example: encrypted arithmetic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>encrypted1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cipher_balance</span>(<span style=color:#ae81ff>100</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>pubkey</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>encrypted2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cipher_balance</span>(<span style=color:#ae81ff>50</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>pubkey</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>sum</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cipher_add</span>(<span style=color:#a6e22e>encrypted1</span>, <span style=color:#a6e22e>encrypted2</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>decipher_balance</span>(<span style=color:#a6e22e>sum</span>, <span style=color:#a6e22e>secretKey</span>); <span style=color:#75715e>// 150n
</span></span></span></code></pre></div><hr><h2 id=zero-knowledge-proofs>Zero-Knowledge Proofs
<a class=anchor href=#zero-knowledge-proofs>#</a></h2><h3 id=proof-of-exponent-poe>Proof of Exponent (POE)
<a class=anchor href=#proof-of-exponent-poe>#</a></h3><p>Proves knowledge of discrete logarithm \\(x\\) such that \\(y = g^x\\):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>prove_fund</span>, <span style=color:#a6e22e>verify_fund</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Generate proof of ownership for funding
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>prove_fund</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>secret</span>: <span style=color:#66d9ef>bigint</span>,           <span style=color:#75715e>// Private key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>publicKey</span>: <span style=color:#66d9ef>ProjectivePoint</span>, <span style=color:#75715e>// Corresponding public key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>amount</span>: <span style=color:#66d9ef>bigint</span>,           <span style=color:#75715e>// Amount being funded
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>nonce</span>: <span style=color:#66d9ef>bigint</span>            <span style=color:#75715e>// Replay protection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ProofOfOwnership</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Verify the proof
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>verify_fund</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>proof</span>: <span style=color:#66d9ef>ProofOfOwnership</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>publicKey</span>: <span style=color:#66d9ef>ProjectivePoint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>amount</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>nonce</span>: <span style=color:#66d9ef>bigint</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Example
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>secret</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>12345</span><span style=color:#a6e22e>n</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pubkey</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>multiply</span>(<span style=color:#a6e22e>secret</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>proof</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>prove_fund</span>(<span style=color:#a6e22e>secret</span>, <span style=color:#a6e22e>pubkey</span>, <span style=color:#ae81ff>1000</span><span style=color:#a6e22e>n</span>, <span style=color:#ae81ff>1</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>valid</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>verify_fund</span>(<span style=color:#a6e22e>proof</span>, <span style=color:#a6e22e>pubkey</span>, <span style=color:#ae81ff>1000</span><span style=color:#a6e22e>n</span>, <span style=color:#ae81ff>1</span><span style=color:#a6e22e>n</span>); <span style=color:#75715e>// true
</span></span></span></code></pre></div><h3 id=transfer-proofs>Transfer Proofs
<a class=anchor href=#transfer-proofs>#</a></h3><p>Complex proofs for confidential transfers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>prove_transfer</span>, <span style=color:#a6e22e>verify_transfer</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>prove_transfer</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>senderSecret</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>senderPubkey</span>: <span style=color:#66d9ef>ProjectivePoint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>receiverPubkey</span>: <span style=color:#66d9ef>ProjectivePoint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>amount</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>currentBalance</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>randomness</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>nonce</span>: <span style=color:#66d9ef>bigint</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ProofOfTransfer</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>verify_transfer</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>proof</span>: <span style=color:#66d9ef>ProofOfTransfer</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>senderPubkey</span>: <span style=color:#66d9ef>ProjectivePoint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>receiverPubkey</span>: <span style=color:#66d9ef>ProjectivePoint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>senderCipher</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>receiverCipher</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>auditCipher</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>remainingCipher</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>nonce</span>: <span style=color:#66d9ef>bigint</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span>;
</span></span></code></pre></div><h3 id=range-proofs>Range Proofs
<a class=anchor href=#range-proofs>#</a></h3><p>Proves values lie in valid ranges using bit decomposition:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>prove_range</span>, <span style=color:#a6e22e>verify_range</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>prove_range</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>randomness</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>commitment</span>: <span style=color:#66d9ef>ProjectivePoint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>bitLength</span>: <span style=color:#66d9ef>number</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ProofOfRange</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>verify_range</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>proof</span>: <span style=color:#66d9ef>ProofOfRange</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>commitment</span>: <span style=color:#66d9ef>ProjectivePoint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>bitLength</span>: <span style=color:#66d9ef>number</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Example: prove amount is in [0, 2^32)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span><span style=color:#a6e22e>n</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>random_scalar</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>commitment</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>multiply</span>(<span style=color:#a6e22e>value</span>).<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>h</span>.<span style=color:#a6e22e>multiply</span>(<span style=color:#a6e22e>r</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>proof</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>prove_range</span>(<span style=color:#a6e22e>value</span>, <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>commitment</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>valid</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>verify_range</span>(<span style=color:#a6e22e>proof</span>, <span style=color:#a6e22e>commitment</span>); <span style=color:#75715e>// true
</span></span></span></code></pre></div><h3 id=withdrawal-proofs>Withdrawal Proofs
<a class=anchor href=#withdrawal-proofs>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>prove_withdraw</span>, <span style=color:#a6e22e>verify_withdraw</span>, <span style=color:#a6e22e>prove_withdraw_all</span>, <span style=color:#a6e22e>verify_withdraw_all</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Partial withdrawal
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>prove_withdraw</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>secret</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>currentBalance</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>withdrawAmount</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>randomness</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>nonce</span>: <span style=color:#66d9ef>bigint</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ProofOfWithdraw</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Full withdrawal (simpler proof)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>prove_withdraw_all</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>secret</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>balance</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>amount</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>nonce</span>: <span style=color:#66d9ef>bigint</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ProofOfWithdrawAll</span>;
</span></span></code></pre></div><hr><h2 id=audit-system>Audit System
<a class=anchor href=#audit-system>#</a></h2><h3 id=ex-post-proofs>Ex-Post Proofs
<a class=anchor href=#ex-post-proofs>#</a></h3><p>Generate proofs for retroactive transaction disclosure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>prove_expost</span>, <span style=color:#a6e22e>verify_expost</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>prove_expost</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>senderSecret</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>amount</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>randomness</span>: <span style=color:#66d9ef>bigint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>originalCipher</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>disclosureKey</span>: <span style=color:#66d9ef>ProjectivePoint</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>ExPostProof</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>verify_expost</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>proof</span>: <span style=color:#66d9ef>ExPostProof</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>senderPubkey</span>: <span style=color:#66d9ef>ProjectivePoint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>disclosureKey</span>: <span style=color:#66d9ef>ProjectivePoint</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>originalCipher</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>disclosedCipher</span>: <span style=color:#66d9ef>CipherBalance</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>disclosureAmount</span>: <span style=color:#66d9ef>CipherBalance</span>
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>bigint</span>; <span style=color:#75715e>// Returns disclosed amount
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Example: prove transfer amount to auditor
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>transferCipher</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>L</span>: <span style=color:#66d9ef>Point1</span>, <span style=color:#a6e22e>R</span>: <span style=color:#66d9ef>Point2</span> };
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>auditorKey</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>multiply</span>(<span style=color:#a6e22e>auditorSecret</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>proof</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>prove_expost</span>(<span style=color:#a6e22e>senderSecret</span>, <span style=color:#a6e22e>amount</span>, <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>transferCipher</span>, <span style=color:#a6e22e>auditorKey</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>disclosedAmount</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>verify_expost</span>(<span style=color:#a6e22e>proof</span>, <span style=color:#a6e22e>senderPubkey</span>, <span style=color:#a6e22e>auditorKey</span>, <span style=color:#a6e22e>transferCipher</span>, <span style=color:#a6e22e>newCipher</span>, <span style=color:#a6e22e>amountCipher</span>);
</span></span></code></pre></div><hr><h2 id=utility-functions>Utility Functions
<a class=anchor href=#utility-functions>#</a></h2><h3 id=key-management>Key Management
<a class=anchor href=#key-management>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>random_scalar</span>, <span style=color:#a6e22e>point_from_hex</span>, <span style=color:#a6e22e>point_to_hex</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Generate cryptographically secure random scalar
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>secret</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>random_scalar</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Derive public key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pubkey</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>g</span>.<span style=color:#a6e22e>multiply</span>(<span style=color:#a6e22e>secret</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Serialize/deserialize points
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>hexString</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>point_to_hex</span>(<span style=color:#a6e22e>pubkey</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>recovered</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>point_from_hex</span>(<span style=color:#a6e22e>hexString</span>);
</span></span></code></pre></div><h3 id=hash-functions>Hash Functions
<a class=anchor href=#hash-functions>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>hash_to_scalar</span>, <span style=color:#a6e22e>hash_points</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Hash arbitrary data to scalar (for challenges)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>challenge</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hash_to_scalar</span>([<span style=color:#a6e22e>point1</span>, <span style=color:#a6e22e>point2</span>, <span style=color:#a6e22e>nonce</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Hash multiple points together
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>combined</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hash_points</span>([<span style=color:#a6e22e>pubkey1</span>, <span style=color:#a6e22e>pubkey2</span>, <span style=color:#a6e22e>commitment</span>]);
</span></span></code></pre></div><hr><h2 id=advanced-features>Advanced Features
<a class=anchor href=#advanced-features>#</a></h2><h3 id=batch-operations>Batch Operations
<a class=anchor href=#batch-operations>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Encrypt multiple amounts efficiently
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>cipher_batch</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>amounts</span>: <span style=color:#66d9ef>bigint</span>[],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>publicKeys</span>: <span style=color:#66d9ef>ProjectivePoint</span>[],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>randomness?</span>: <span style=color:#66d9ef>bigint</span>[]
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>CipherBalance</span>[];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Verify multiple proofs together
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>verify_batch_fund</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>proofs</span>: <span style=color:#66d9ef>ProofOfOwnership</span>[],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>publicKeys</span>: <span style=color:#66d9ef>ProjectivePoint</span>[],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>amounts</span>: <span style=color:#66d9ef>bigint</span>[],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>nonces</span>: <span style=color:#66d9ef>bigint</span>[]
</span></span><span style=display:flex><span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>boolean</span>;
</span></span></code></pre></div><h3 id=custom-generators>Custom Generators
<a class=anchor href=#custom-generators>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Use custom generators for specific applications
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>SHE</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>customSHE</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>SHE</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>generator</span>: <span style=color:#66d9ef>customG</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>secondGenerator</span>: <span style=color:#66d9ef>customH</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>curve</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;stark&#39;</span> <span style=color:#75715e>// or custom curve parameters
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>});
</span></span></code></pre></div><hr><h2 id=performance-considerations>Performance Considerations
<a class=anchor href=#performance-considerations>#</a></h2><h3 id=optimization-tips>Optimization Tips
<a class=anchor href=#optimization-tips>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Cache expensive computations
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>precomputed</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>gTable</span>: <span style=color:#66d9ef>g.precomputeWindow</span>(<span style=color:#ae81ff>8</span>),    <span style=color:#75715e>// Precompute for faster scalar multiplication
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>hTable</span>: <span style=color:#66d9ef>h.precomputeWindow</span>(<span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Use batch verification when possible
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>allValid</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>verify_batch_fund</span>(<span style=color:#a6e22e>proofs</span>, <span style=color:#a6e22e>pubkeys</span>, <span style=color:#a6e22e>amounts</span>, <span style=color:#a6e22e>nonces</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Limit brute force range for decryption
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>amount</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>decipher_balance</span>(<span style=color:#a6e22e>cipher</span>, <span style=color:#a6e22e>secret</span>, <span style=color:#ae81ff>100000</span><span style=color:#a6e22e>n</span>); <span style=color:#75715e>// Reasonable upper bound
</span></span></span></code></pre></div><h3 id=memory-management>Memory Management
<a class=anchor href=#memory-management>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Clean up large proof objects after use
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>cleanupProof</span>(<span style=color:#a6e22e>proof</span>: <span style=color:#66d9ef>ProofOfTransfer</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Proof objects can be large (~32KB)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// Consider cleanup in memory-constrained environments
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>proof</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=error-handling>Error Handling
<a class=anchor href=#error-handling>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>SHEError</span>, <span style=color:#a6e22e>ProofError</span>, <span style=color:#a6e22e>DecryptionError</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;she-js&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>proof</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>prove_transfer</span>(<span style=color:#75715e>/* ... */</span>);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>ProofError</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Proof generation failed:&#39;</span>, <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>error</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>DecryptionError</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;Decryption failed:&#39;</span>, <span style=color:#a6e22e>error</span>.<span style=color:#a6e22e>message</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=type-definitions>Type Definitions
<a class=anchor href=#type-definitions>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CipherBalance</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>L</span>: <span style=color:#66d9ef>ProjectivePoint</span>;  <span style=color:#75715e>// g^amount * pubkey^randomness
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>R</span>: <span style=color:#66d9ef>ProjectivePoint</span>;  <span style=color:#75715e>// g^randomness
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ProofOfOwnership</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>A</span>: <span style=color:#66d9ef>ProjectivePoint</span>;  <span style=color:#75715e>// Commitment
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>s</span>: <span style=color:#66d9ef>bigint</span>;          <span style=color:#75715e>// Response
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ProofOfRange</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>commitments</span>: <span style=color:#66d9ef>ProjectivePoint</span>[];     <span style=color:#75715e>// Bit commitments
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>responses</span>: <span style=color:#66d9ef>ProofOfOwnership</span>[];      <span style=color:#75715e>// OR proofs for each bit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>challenge</span>: <span style=color:#66d9ef>bigint</span>;                  <span style=color:#75715e>// Fiat-Shamir challenge
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ExPostProof</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ownership</span>: <span style=color:#66d9ef>ProofOfOwnership</span>;        <span style=color:#75715e>// Proof of sender key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>consistency</span>: <span style=color:#66d9ef>ProofOfOwnership</span>;      <span style=color:#75715e>// Proof of amount consistency
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>senderCipher</span>: <span style=color:#66d9ef>CipherBalance</span>;       <span style=color:#75715e>// New sender encryption
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>disclosureCipher</span>: <span style=color:#66d9ef>CipherBalance</span>;   <span style=color:#75715e>// Disclosure party encryption
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>The SHE library provides the cryptographic foundation for all Tongo operations, implementing state-of-the-art zero-knowledge proofs with efficient elliptic curve arithmetic.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/fatlabsxyz/tongo-docs/edit/master/packages/tongo-docs/content/docs/she.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#installation>Installation</a></li><li><a href=#core-concepts>Core Concepts</a><ul><li><a href=#elliptic-curve-setup>Elliptic Curve Setup</a></li></ul></li><li><a href=#elgamal-encryption>ElGamal Encryption</a><ul><li><a href=#basic-encryption>Basic Encryption</a></li><li><a href=#decryption>Decryption</a></li><li><a href=#homomorphic-operations>Homomorphic Operations</a></li></ul></li><li><a href=#zero-knowledge-proofs>Zero-Knowledge Proofs</a><ul><li><a href=#proof-of-exponent-poe>Proof of Exponent (POE)</a></li><li><a href=#transfer-proofs>Transfer Proofs</a></li><li><a href=#range-proofs>Range Proofs</a></li><li><a href=#withdrawal-proofs>Withdrawal Proofs</a></li></ul></li><li><a href=#audit-system>Audit System</a><ul><li><a href=#ex-post-proofs>Ex-Post Proofs</a></li></ul></li><li><a href=#utility-functions>Utility Functions</a><ul><li><a href=#key-management>Key Management</a></li><li><a href=#hash-functions>Hash Functions</a></li></ul></li><li><a href=#advanced-features>Advanced Features</a><ul><li><a href=#batch-operations>Batch Operations</a></li><li><a href=#custom-generators>Custom Generators</a></li></ul></li><li><a href=#performance-considerations>Performance Considerations</a><ul><li><a href=#optimization-tips>Optimization Tips</a></li><li><a href=#memory-management>Memory Management</a></li></ul></li><li><a href=#error-handling>Error Handling</a></li><li><a href=#type-definitions>Type Definitions</a></li></ul></nav></div></aside></main></body></html>